{
"version":3,
"file":"index.js",
"sourceRoot":"file:///",
"sources":["/Users/matthijs/Documents/workingdir/haxe/hxskeletor/src/MainHeroku.hx","/usr/local/lib/haxe/std/js/_std/Std.hx","/usr/local/lib/haxe/std/haxe/Timer.hx","/usr/local/lib/haxe/std/js/Boot.hx","/Users/matthijs/Documents/workingdir/haxe/hxskeletor/src/server/Controller.hx","/Users/matthijs/Documents/workingdir/haxe/hxskeletor/src/server/Router.hx","/Users/matthijs/Documents/workingdir/haxe/hxskeletor/src/model/constants/App.hx"],
"sourcesContent":["package;\n\nimport js.Node.*;\nimport js.Node;\nimport js.Node.console;\n\nimport js.node.Fs;\nimport js.node.Path;\nimport js.node.Require;\n\nimport js.npm.SocketIo;\nimport js.npm.Request;\n\nimport js.npm.Express;\nimport js.npm.express.*;\nimport js.npm.express.Request;\nimport js.npm.express.Response;\n\nimport model.constants.App;\nimport server.Router;\n\nimport haxe.Timer;\nusing StringTools;\n\n/**\n * @author Matthijs Kamstra aka [mck]\n * MIT\n */\nclass MainHeroku {\n\n\tvar app : js.npm.Express;\n\tvar server : js.node.http.Server;\n\tpublic static var io : js.npm.socketio.Server;\n\n\n\tpublic function new () {\n\t\tconsole.log('${App.PROJECT_NAME} build: ${App.BUILD}');\n\n\t\ttrace('${App.PROJECT_NAME} start Heroku server');\n\n\t\tvar port = Sys.getEnv(\"PORT\");\n\t\tif(port == null) port = App.PORT;\n\t\ttrace('port: $port');\n\n\t\tapp    = new js.npm.Express();\n\t\tserver = js.node.Http.createServer( cast app );\n\t\tio     = new js.npm.socketio.Server(server);\n\n\t\t// setup\n\t\t// app.set('port', port);\n\n\t\t// use\n\t\tapp.use(new Favicon(Node.__dirname + '/favicon.ico'));\t\t\t// because I like favicons\n\t\tapp.use(new Morgan('dev'));\t\t\t\t\t\t\t\t\t\t// set morgan to log info about our requests for development use.\n\t\tapp.use(BodyParser.json());\t\t\t\t\t\t\t\t\t\t// support json encoded bodies\n\t\tapp.use(BodyParser.urlencoded({ extended: true }));\t\t\t\t// initialize body-parser to parse incoming parameters requests to req.body\n\t\tapp.use(new Static(Path.join(Node.__dirname, 'public')));\n\t\tapp.use(new CookieParser());\t\t\t\t\t\t\t\t\t// initialize cookie-parser to allow us access the cookies stored in the browser.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// initialize express-session to allow us track the logged-in user across sessions.\n\t\tapp.use(new Session({\n\t\t\tname: 'user_sid',\n\t\t\tsecret: 'skeleton_123_randomstuff',\n\t\t\tresave: false,\n\t\t\tsaveUninitialized: false,\n\t\t\tcookie: {\n\t\t\t\tmaxAge: 600000\n\t\t\t}\n\n\t\t}));\n\t\tapp.use(untyped checkAuth ); \t\t\t\t\t\t\t\t\t// need to fix this in the externs\n\n\t\t// Routes\n\t\tRouter.init(app); \t\t\t\t\t\t\t\t\t\t\t\t// init router\n\n\t\t// socket stuff\n\t\tio.on('connection', function (socket) {\n\t\t\tsocket.emit('message', { message: 'Welcome from the Heroku server - ${App.PROJECT_NAME}' });\n\t\t\tsocket.on('send', function (data:Dynamic) {\n\t\t\t\tio.sockets.emit('id', data.id);\n\t\t\t\ttrace('send data -> ' + data.id);\n\t\t\t});\n\t\t\tsocket.on('disconnect', function (data:Dynamic) {\n        \t\tconsole.log('user disconnected');\n    \t\t});\n\t\t\tsocket.on('toggle', function (data:Dynamic) {\n        \t\tconsole.log('server toggle: ${data}');\n\t\t\t\tvar isChecked = data.checked;\n\t\t\t\tif(isChecked){\n\t\t\t\t\ttrace('server - toggle : TRUE : isChecked : ${isChecked}');\n\t\t\t\t\t// reset toggle after 3 seconds\n\t\t\t\t\thaxe.Timer.delay(function (){\n\t\t\t\t\t\ttrace('server - toggle - reset after 3 seconds');\n\t\t\t\t\t\tio.sockets.emit('toggle', {checked:false});\n\t\t\t\t\t}, 3000);\n\t\t\t\t} else {\n\t\t\t\t\ttrace('server - toggle : FALSE : isChecked : ${isChecked}');\n\t\t\t\t}\n    \t\t});\n\t\t});\n\n\t\t// use this last...\n\t\tapp.use(function(req, res, next) {\n\t\t\tres.status(404).send('404');\n\t\t\t// res.status(404).send(output);\n\t\t});\n\n\t\t// server.listen(app.get('port'));\n\t\t// trace('Listening on port: ${app.get('port')} (http://localhost:${app.get('port')})');\n\t\tserver.listen(port);\n\t\ttrace('Listening on port: ${port} (http://localhost:${port})');\n\t}\n\n\t/**\n\t *  this function needs to be moved to Router (I guess?)\n\t *  @param req -\n\t *  @param res -\n\t *  @param next -\n\t */\n\tfunction checkAuth (req:Dynamic, res, next) {\n\t\t// console.log('checkAuth ' + req.url);\n\t\t// trace('${req.url}');\n\t\t// trace('${req.session}');\n\t\t// trace('${req.session.authenticated }');\n\n\t\tvar loginPathArray = ['/secure', '/secure1'];\n\t\tvar secureURL = false;\n\t\tfor (i in loginPathArray){\n\t\t\tif(i == req.url) secureURL = true;\n\t\t}\n\n\t\t// don't serve /secure to those not logged in\n\t\t// you should add to this list, for each and every secure url\n\t\t// if (req.url == '/secure' && (req.session == null || req.session.authenticated != true)) {\n\t\tif (secureURL && (req.session == null || req.session.authenticated != true)) {\n\t\t\tres.redirect('/login');\n\t\t\t// res.sendStatus(401);\n\t\t\treturn;\n\t\t}\n\t\tnext();\n\t}\n\n\tstatic public function main () {\n\t\tvar app = new MainHeroku ();\n\t}\n}\n\n\n\n","/*\n * Copyright (C)2005-2017 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\nimport js.Boot;\n\n@:keepInit\n@:coreApi class Std {\n\n\tpublic static inline function is( v : Dynamic, t : Dynamic ) : Bool {\n\t\treturn untyped js.Boot.__instanceof(v,t);\n\t}\n\n\tpublic static inline function instance<T:{},S:T>( value : T, c : Class<S> ) : S {\n\t\treturn untyped __instanceof__(value, c) ? cast value : null;\n\t}\n\n\t@:pure\n\tpublic static function string( s : Dynamic ) : String {\n\t\treturn untyped js.Boot.__string_rec(s,\"\");\n\t}\n\n\tpublic static inline function int( x : Float ) : Int {\n\t\treturn (cast x) | 0;\n\t}\n\n\t@:pure\n\tpublic static function parseInt( x : String ) : Null<Int> {\n\t\tvar v = untyped __js__(\"parseInt\")(x, 10);\n\t\t// parse again if hexadecimal\n\t\tif( v == 0 && (x.charCodeAt(1) == 'x'.code || x.charCodeAt(1) == 'X'.code) )\n\t\t\tv = untyped __js__(\"parseInt\")(x);\n\t\tif( untyped __js__(\"isNaN\")(v) )\n\t\t\treturn null;\n\t\treturn cast v;\n\t}\n\n\tpublic static inline function parseFloat( x : String ) : Float {\n\t\treturn untyped __js__(\"parseFloat\")(x);\n\t}\n\n\tpublic static function random( x : Int ) : Int {\n\t\treturn x <= 0 ? 0 : Math.floor(Math.random()*x);\n\t}\n\n\tstatic function __init__() : Void untyped {\n\t\t__feature__(\"js.Boot.getClass\",String.prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"String\"] = String,String));\n\t\t__feature__(\"js.Boot.isClass\",String.__name__ = __feature__(\"Type.getClassName\",[\"String\"],true));\n\t\t__feature__(\"Type.resolveClass\",$hxClasses[\"Array\"] = Array);\n\t\t__feature__(\"js.Boot.isClass\",Array.__name__ = __feature__(\"Type.getClassName\",[\"Array\"],true));\n\t\t__feature__(\"Date.*\", {\n\t\t\t__feature__(\"js.Boot.getClass\",__js__('Date').prototype.__class__ = __feature__(\"Type.resolveClass\",$hxClasses[\"Date\"] = __js__('Date'),__js__('Date')));\n\t\t\t__feature__(\"js.Boot.isClass\",__js__('Date').__name__ = [\"Date\"]);\n\t\t});\n\t\t__feature__(\"Int.*\",{\n\t\t\tvar Int = __feature__(\"Type.resolveClass\", $hxClasses[\"Int\"] = { __name__ : [\"Int\"] }, { __name__ : [\"Int\"] });\n\t\t});\n\t\t__feature__(\"Dynamic.*\",{\n\t\t\tvar Dynamic = __feature__(\"Type.resolveClass\", $hxClasses[\"Dynamic\"] = { __name__ : [\"Dynamic\"] }, { __name__ : [\"Dynamic\"] });\n\t\t});\n\t\t__feature__(\"Float.*\",{\n\t\t\tvar Float = __feature__(\"Type.resolveClass\", $hxClasses[\"Float\"] = __js__(\"Number\"), __js__(\"Number\"));\n\t\t\tFloat.__name__ = [\"Float\"];\n\t\t});\n\t\t__feature__(\"Bool.*\",{\n\t\t\tvar Bool = __feature__(\"Type.resolveEnum\",$hxClasses[\"Bool\"] = __js__(\"Boolean\"), __js__(\"Boolean\"));\n\t\t\tBool.__ename__ = [\"Bool\"];\n\t\t});\n\t\t__feature__(\"Class.*\",{\n\t\t\tvar Class = __feature__(\"Type.resolveClass\", $hxClasses[\"Class\"] = { __name__ : [\"Class\"] }, { __name__ : [\"Class\"] });\n\t\t});\n\t\t__feature__(\"Enum.*\",{\n\t\t\tvar Enum = {};\n\t\t});\n\t\t__feature__(\"Void.*\",{\n\t\t\tvar Void = __feature__(\"Type.resolveEnum\", $hxClasses[\"Void\"] = { __ename__ : [\"Void\"] }, { __ename__ : [\"Void\"] });\n\t\t});\n\n#if (js_es < 5)\n\t\t__feature__(\"Array.map\",\n\t\t\tif( Array.prototype.map == null )\n\t\t\t\tArray.prototype.map = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length )\n\t\t\t\t\t\ta[i] = f(__this__[i]);\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n\t\t__feature__(\"Array.filter\",\n\t\t\tif( Array.prototype.filter == null )\n\t\t\t\tArray.prototype.filter = function(f) {\n\t\t\t\t\tvar a = [];\n\t\t\t\t\tfor( i in 0...__this__.length ) {\n\t\t\t\t\t\tvar e = __this__[i];\n\t\t\t\t\t\tif( f(e) ) a.push(e);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}\n\t\t);\n#end\n\t}\n\n}\n","/*\n * Copyright (C)2005-2017 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage haxe;\n\n/**\n\tThe Timer class allows you to create asynchronous timers on platforms that\n\tsupport events.\n\n\tThe intended usage is to create an instance of the Timer class with a given\n\tinterval, set its run() method to a custom function to be invoked and\n\teventually call stop() to stop the Timer.\n\n\tNote that a running Timer may or may not prevent the program to exit\n\tautomatically when main() returns.\n\n\tIt is also possible to extend this class and override its run() method in\n\tthe child class.\n**/\nclass Timer {\n\n\t#if (flash || js)\n\t\tprivate var id : Null<Int>;\n\t#elseif java\n\t\tprivate var timer : java.util.Timer;\n\t\tprivate var task : java.util.TimerTask;\n\t#else\n\t\tprivate var event : MainLoop.MainEvent;\n\t#end\n\n\t/**\n\t\tCreates a new timer that will run every `time_ms` milliseconds.\n\n\t\tAfter creating the Timer instance, it calls `this.run` repeatedly,\n\t\twith delays of `time_ms` milliseconds, until `this.stop` is called.\n\n\t\tThe first invocation occurs after `time_ms` milliseconds, not\n\t\timmediately.\n\n\t\tThe accuracy of this may be platform-dependent.\n\t**/\n\tpublic function new( time_ms : Int ){\n\t\t#if flash\n\t\t\tvar me = this;\n\t\t\tid = untyped __global__[\"flash.utils.setInterval\"](function() { me.run(); },time_ms);\n\t\t#elseif js\n\t\t\tvar me = this;\n\t\t\tid = untyped setInterval(function() me.run(),time_ms);\n\t\t#elseif java\n\t\t\ttimer = new java.util.Timer();\n\t\t\ttimer.scheduleAtFixedRate(task = new TimerTask(this), haxe.Int64.ofInt(time_ms), haxe.Int64.ofInt(time_ms));\n\t\t#else\n\t\t\tvar dt = time_ms / 1000;\n\t\t\tevent = MainLoop.add(function() {\n\t\t\t\t@:privateAccess event.nextRun += dt;\n\t\t\t\trun();\n\t\t\t});\n\t\t\tevent.delay(dt);\n\t\t#end\n\t}\n\n\t/**\n\t\tStops `this` Timer.\n\n\t\tAfter calling this method, no additional invocations of `this.run`\n\t\twill occur.\n\n\t\tIt is not possible to restart `this` Timer once stopped.\n\t**/\n\tpublic function stop() {\n\t\t#if (flash || js)\n\t\t\tif( id == null )\n\t\t\t\treturn;\n\t\t\t#if flash\n\t\t\t\tuntyped __global__[\"flash.utils.clearInterval\"](id);\n\t\t\t#elseif js\n\t\t\t\tuntyped clearInterval(id);\n\t\t\t#end\n\t\t\tid = null;\n\t\t#elseif java\n\t\t\tif(timer != null) {\n\t\t\t\ttimer.cancel();\n\t\t\t\ttimer = null;\n\t\t\t}\n\t\t\ttask = null;\n\t\t#else\n\t\t\tif( event != null ) {\n\t\t\t\tevent.stop();\n\t\t\t\tevent = null;\n\t\t\t}\n\t\t#end\n\t}\n\n\t/**\n\t\tThis method is invoked repeatedly on `this` Timer.\n\n\t\tIt can be overridden in a subclass, or rebound directly to a custom\n\t\tfunction:\n\t\t\tvar timer = new haxe.Timer(1000); // 1000ms delay\n\t\t\ttimer.run = function() { ... }\n\n\t\tOnce bound, it can still be rebound to different functions until `this`\n\t\tTimer is stopped through a call to `this.stop`.\n\t**/\n\tpublic dynamic function run() {\n\n\t}\n\n\t/**\n\t\tInvokes `f` after `time_ms` milliseconds.\n\n\t\tThis is a convenience function for creating a new Timer instance with\n\t\t`time_ms` as argument, binding its run() method to `f` and then stopping\n\t\t`this` Timer upon the first invocation.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function delay( f : Void -> Void, time_ms : Int ) {\n\t\tvar t = new haxe.Timer(time_ms);\n\t\tt.run = function() {\n\t\t\tt.stop();\n\t\t\tf();\n\t\t};\n\t\treturn t;\n\t}\n\n\t/**\n\t\tMeasures the time it takes to execute `f`, in seconds with fractions.\n\n\t\tThis is a convenience function for calculating the difference between\n\t\tTimer.stamp() before and after the invocation of `f`.\n\n\t\tThe difference is passed as argument to Log.trace(), with \"s\" appended\n\t\tto denote the unit. The optional `pos` argument is passed through.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function measure<T>( f : Void -> T, ?pos : PosInfos ) : T {\n\t\tvar t0 = stamp();\n\t\tvar r = f();\n\t\tLog.trace((stamp() - t0) + \"s\", pos);\n\t\treturn r;\n\t}\n\n\t/**\n\t\tReturns a timestamp, in seconds with fractions.\n\n\t\tThe value itself might differ depending on platforms, only differences\n\t\tbetween two values make sense.\n\t**/\n\tpublic static inline function stamp() : Float {\n\t\t#if flash\n\t\t\treturn flash.Lib.getTimer() / 1000;\n\t\t#elseif (neko || php)\n\t\t\treturn Sys.time();\n\t\t#elseif js\n\t\t\treturn Date.now().getTime() / 1000;\n\t\t#elseif cpp\n\t\t\treturn untyped __global__.__time_stamp();\n\t\t#elseif python\n\t\t\treturn Sys.cpuTime();\n\t\t#elseif sys\n\t\t\treturn Sys.time();\n\n\t\t#else\n\t\t\treturn 0;\n\t\t#end\n\t}\n\n}\n\n#if java\n@:nativeGen\nprivate class TimerTask extends java.util.TimerTask {\n\tvar timer:Timer;\n\tpublic function new(timer:Timer):Void {\n\t\tsuper();\n\t\tthis.timer = timer;\n\t}\n\n\t@:overload override public function run():Void {\n\t\ttimer.run();\n\t}\n}\n#end\n","/*\n * Copyright (C)2005-2017 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\npackage js;\n\nprivate class HaxeError extends js.Error {\n\n\tvar val:Dynamic;\n\n\tpublic function new(val:Dynamic) untyped {\n\t\tsuper();\n\t\tthis.val = __define_feature__(\"js.Boot.HaxeError\", val);\n\t\tthis.message = String(val);\n\t\tif (js.Error.captureStackTrace) js.Error.captureStackTrace(this, HaxeError);\n\t}\n\n\tpublic static function wrap(val:Dynamic):Dynamic untyped {\n\t\treturn if (__instanceof__(val, js.Error)) val else new HaxeError(val);\n\t}\n}\n\n@:dox(hide)\nclass Boot {\n\n\tprivate static function __unhtml(s : String) {\n\t\treturn s.split(\"&\").join(\"&amp;\").split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n\t}\n\n\tprivate static function __trace(v,i : haxe.PosInfos) {\n\t\tuntyped {\n\t\t\tvar msg = if( i != null ) i.fileName+\":\"+i.lineNumber+\": \" else \"\";\n\t\t\t#if jsfl\n\t\t\tmsg += __string_rec(v,\"\");\n\t\t\tfl.trace(msg);\n\t\t\t#else\n\t\t\tmsg += __string_rec(v, \"\");\n\t\t\tif( i != null && i.customParams != null )\n\t\t\t\tfor( v in i.customParams )\n\t\t\t\t\tmsg += \",\" + __string_rec(v, \"\");\n\t\t\tvar d;\n\t\t\tif( __js__(\"typeof\")(document) != \"undefined\" && (d = document.getElementById(\"haxe:trace\")) != null )\n\t\t\t\td.innerHTML += __unhtml(msg)+\"<br/>\";\n\t\t\telse if( __js__(\"typeof console\") != \"undefined\" && __js__(\"console\").log != null )\n\t\t\t\t__js__(\"console\").log(msg);\n\t\t\t#end\n\t\t}\n\t}\n\n\tprivate static function __clear_trace() {\n\t\tuntyped {\n\t\t\t#if jsfl\n\t\t\tfl.outputPanel.clear();\n\t\t\t#else\n\t\t\tvar d = document.getElementById(\"haxe:trace\");\n\t\t\tif( d != null )\n\t\t\t\td.innerHTML = \"\";\n\t\t\t#end\n\t\t}\n\t}\n\n\tstatic inline function isClass(o:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isClass\", o.__name__);\n\t}\n\n\tstatic inline function isEnum(e:Dynamic) : Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isEnum\", e.__ename__);\n\t}\n\n\tstatic function getClass(o:Dynamic) : Dynamic {\n\t\tif (Std.is(o, Array))\n\t\t\treturn Array;\n\t\telse {\n\t\t\tvar cl = untyped __define_feature__(\"js.Boot.getClass\", o.__class__);\n\t\t\tif (cl != null)\n\t\t\t\treturn cl;\n\t\t\tvar name = __nativeClassName(o);\n\t\t\tif (name != null)\n\t\t\t\treturn __resolveNativeClass(name);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t@:ifFeature(\"has_enum\")\n\tprivate static function __string_rec(o,s:String) {\n\t\tuntyped {\n\t\t\tif( o == null )\n\t\t\t    return \"null\";\n\t\t\tif( s.length >= 5 )\n\t\t\t\treturn \"<...>\"; // too much deep recursion\n\t\t\tvar t = __js__(\"typeof(o)\");\n\t\t\tif( t == \"function\" && (isClass(o) || isEnum(o)) )\n\t\t\t\tt = \"object\";\n\t\t\tswitch( t ) {\n\t\t\tcase \"object\":\n\t\t\t\tif( __js__(\"o instanceof Array\") ) {\n\t\t\t\t\tif( o.__enum__ ) {\n\t\t\t\t\t\tif( o.length == 2 )\n\t\t\t\t\t\t\treturn o[0];\n\t\t\t\t\t\tvar str = o[0]+\"(\";\n\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\tfor( i in 2...o.length ) {\n\t\t\t\t\t\t\tif( i != 2 )\n\t\t\t\t\t\t\t\tstr += \",\" + __string_rec(o[i],s);\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tstr += __string_rec(o[i],s);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn str + \")\";\n\t\t\t\t\t}\n\t\t\t\t\tvar l = o.length;\n\t\t\t\t\tvar i;\n\t\t\t\t\tvar str = \"[\";\n\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\tfor( i in 0...l )\n\t\t\t\t\t\tstr += (if (i > 0) \",\" else \"\")+__string_rec(o[i],s);\n\t\t\t\t\tstr += \"]\";\n\t\t\t\t\treturn str;\n\t\t\t\t}\n\t\t\t\tvar tostr;\n\t\t\t\ttry {\n\t\t\t\t\ttostr = untyped o.toString;\n\t\t\t\t} catch( e : Dynamic ) {\n\t\t\t\t\t// strange error on IE\n\t\t\t\t\treturn \"???\";\n\t\t\t\t}\n\t\t\t\tif( tostr != null && tostr != __js__(\"Object.toString\") && __typeof__(tostr) == \"function\" ) {\n\t\t\t\t\tvar s2 = o.toString();\n\t\t\t\t\tif( s2 != \"[object Object]\")\n\t\t\t\t\t\treturn s2;\n\t\t\t\t}\n\t\t\t\tvar k : String = null;\n\t\t\t\tvar str = \"{\\n\";\n\t\t\t\ts += \"\\t\";\n\t\t\t\tvar hasp = (o.hasOwnProperty != null);\n\t\t\t\t__js__(\"for( var k in o ) {\");\n\t\t\t\t\tif( hasp && !o.hasOwnProperty(k) )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\" )\n\t\t\t\t\t\t__js__(\"continue\");\n\t\t\t\t\tif( str.length != 2 )\n\t\t\t\t\t\tstr += \", \\n\";\n\t\t\t\t\tstr += s + k + \" : \"+__string_rec(o[k],s);\n\t\t\t\t__js__(\"}\");\n\t\t\t\ts = s.substring(1);\n\t\t\t\tstr += \"\\n\" + s + \"}\";\n\t\t\t\treturn str;\n\t\t\tcase \"function\":\n\t\t\t\treturn \"<function>\";\n\t\t\tcase \"string\":\n\t\t\t\treturn o;\n\t\t\tdefault:\n\t\t\t\treturn String(o);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate static function __interfLoop(cc : Dynamic,cl : Dynamic) {\n\t\tif( cc == null )\n\t\t\treturn false;\n\t\tif( cc == cl )\n\t\t\treturn true;\n\t\tvar intf : Dynamic = cc.__interfaces__;\n\t\tif( intf != null )\n\t\t\tfor( i in 0...intf.length ) {\n\t\t\t\tvar i : Dynamic = intf[i];\n\t\t\t\tif( i == cl || __interfLoop(i,cl) )\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\treturn __interfLoop(cc.__super__,cl);\n\t}\n\n\t@:ifFeature(\"typed_catch\") private static function __instanceof(o : Dynamic,cl : Dynamic) {\n\t\tif( cl == null )\n\t\t\treturn false;\n\t\tswitch( cl ) {\n\t\tcase Int:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\" && untyped __js__(\"(o|0) === o\");\n\t\tcase Float:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"number\";\n\t\tcase Bool:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"boolean\";\n\t\tcase String:\n\t\t\treturn (untyped __js__(\"typeof\"))(o) == \"string\";\n\t\tcase Array:\n\t\t\treturn (untyped __js__(\"(o instanceof Array)\")) && o.__enum__ == null;\n\t\tcase Dynamic:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\tif( o != null ) {\n\t\t\t\t// Check if o is an instance of a Haxe class or a native JS object\n\t\t\t\tif( (untyped __js__(\"typeof\"))(cl) == \"function\" ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\tif( __interfLoop(getClass(o),cl) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\telse if ( (untyped __js__(\"typeof\"))(cl) == \"object\" && __isNativeObj(cl) ) {\n\t\t\t\t\tif( untyped __js__(\"o instanceof cl\") )\n\t\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// do not use isClass/isEnum here\n\t\t\tuntyped __feature__(\"Class.*\",if( cl == Class && o.__name__ != null ) return true);\n\t\t\tuntyped __feature__(\"Enum.*\",if( cl == Enum && o.__ename__ != null ) return true);\n\t\t\treturn o.__enum__ == cl;\n\t\t}\n\t}\n\n\t@:ifFeature(\"typed_cast\") private static function __cast(o : Dynamic, t : Dynamic) {\n\t\tif (__instanceof(o, t)) return o;\n\t\telse throw \"Cannot cast \" +Std.string(o) + \" to \" +Std.string(t);\n\t}\n\n\tstatic var __toStr = untyped ({}).toString;\n\t// get native JS [[Class]]\n\tstatic function __nativeClassName(o:Dynamic):String {\n\t\tvar name = untyped __toStr.call(o).slice(8, -1);\n\t\t// exclude general Object and Function\n\t\t// also exclude Math and JSON, because instanceof cannot be called on them\n\t\tif (name == \"Object\" || name == \"Function\" || name == \"Math\" || name == \"JSON\")\n\t\t\treturn null;\n\t\treturn name;\n\t}\n\n\t// check for usable native JS object\n\tstatic function __isNativeObj(o:Dynamic):Bool {\n\t\treturn __nativeClassName(o) != null;\n\t}\n\n\t// resolve native JS class in the global scope:\n\tstatic function __resolveNativeClass(name:String) {\n\t\treturn untyped js.Lib.global[name];\n\t}\n\n}\n","package server;\n\nimport js.Node;\nimport js.node.Fs;\nimport js.npm.express.*;\n\nimport js.Node.console;\n\nimport model.constants.App;\n\n// import msignal.Signal;\n\nclass Controller {\n\n\tpublic static function index(req:Request,res:Response) {\n\t\tres.sendfile(Node.__dirname + '/public/_index.html');\n\t}\n\n\tpublic static function logout(req:Request,res:Response) {\n\t\t// res.sendfile(Node.__dirname + '/public/login.html');\n\t\tuntyped req.session.destroy();\n\t\tres.redirect('/');\n\t}\n\tpublic static function login(req:Request,res:Response) {\n\t\tres.sendfile(Node.__dirname + '/public/login.html');\n\t}\n\tpublic static function loginPost(req:Request,res:Response, next) {\n\t\t// res.sendfile(Node.__dirname + '/public/secure.html');\n\t\t// trace(req);\n\t\t// trace(res);\n\t\t// trace(next);\n\n\t\t// you might like to do a database look-up or something more scalable here\n\t\tif (untyped req.body.username != null &&\n\t\t\tuntyped req.body.username == 'user' &&\n\t\t\tuntyped req.body.password != null &&\n\t\t\tuntyped req.body.password == 'pass'\n\t\t\t){\n\t\t\tuntyped req.session.authenticated = true;\n\t\t\tres.redirect('/secure');\n\t\t} else {\n\t\t\t// req.flash('error', 'Username and password are incorrect');\n\t\t\tres.redirect('/login');\n\t\t}\n\t}\n\n\n\n\n\n\n\n\tpublic static function api(req:Request,res:Response) {\n\t\tres.send('api: ${App.BUILD}');\n\t}\n\tpublic static function apiPost(req:Request,res:Response) {\n\t\tconsole.log('api');\n\t\tconsole.log(req);\n\t\tconsole.log(res);\n\t\t// console.log(res.body);\n\t\t// console.log(req.body);\n\t}\n\n\t/**\n\t *  test/testId/testById/testFooById\n\t *\n\t *  @param req -\n\t *  @param res -\n\t */\n\tpublic static function test(req:Request,res:Response) {\n\t\t// res.sendfile(Node.__dirname + '/public/test.html');\n\t\tvar _url = Node.__dirname +  '/private/test.json';\n\t\tres.send(Fs.readFileSync(_url, \"utf8\"));\n\t}\n\tpublic static function testId(req:Request,res:Response) {\n\t\tres.sendfile(Node.__dirname + '/public/test.html');\n\t}\n\tpublic static function testById(req:Request,res:Response) {\n\t\tres.send('testById: ${req.params.id}');\n\t\tvar _id = req.params.id;\n\t\t// var _url = Node.__dirname +  '/_data/${Folder.GITLAB}/gitlab_project_issues_${_id}.json';\n\t\t// res.send(haxe.Json.parse(Fs.readFileSync(_url, \"utf8\")));\n\t\t// res.sendfile(Node.__dirname + '/public/test.html');\n\t}\n\tpublic static function testFooById(req:Request,res:Response) {\n\t\tres.send('testFooById: ${req.params.id}');\n\t\t// res.sendfile(Node.__dirname + '/public/test.html');\n\t}\n\n\tpublic static function ping(req:Request,res:Response) {\n\t\tres.send('test:ping');\n\t\tvar io = MainHeroku.io;\n\t\tio.sockets.emit('test:ping', App.PROJECT_NAME);\n\t}\n\tpublic static function toggle(req:Request,res:Response) {\n\t\t// res.send('toggle');\n\t\tvar io = MainHeroku.io;\n\t\tio.sockets.emit('toggle', App.PROJECT_NAME);\n\t\tres.sendfile(Node.__dirname + '/public/toggle.html');\n\t}\n\tpublic static function version(req:Request,res:Response) {\n\t\tres.send('version: ${App.BUILD}');\n\t\tvar io = MainHeroku.io;\n\t\tio.sockets.emit('version', App.BUILD);\n\t}\n\tpublic static function secure(req:Request,res:Response) {\n\t\t// res.send('secure: ${App.BUILD}');\n\t\tres.sendfile(Node.__dirname + '/public/secure.html');\n\t\tvar io = MainHeroku.io;\n\t\tio.sockets.emit('version', App.BUILD);\n\t}\n\tpublic static function secure1(req:Request,res:Response) {\n\t\t// res.send('secure: ${App.BUILD}');\n\t\tres.sendfile(Node.__dirname + '/public/secure.html');\n\t\tvar io = MainHeroku.io;\n\t\tio.sockets.emit('version', App.BUILD);\n\t}\n\tpublic static function update(req:Request,res:Response) {\n\t\tres.send('update: ${App.BUILD}');\n\t\tvar io = MainHeroku.io;\n\t\tio.sockets.emit('update', App.BUILD);\n\t}\n\n}","package server;\n\nimport js.npm.Express;\n\nclass Router {\n\n\tpublic static function init(app : Express):Void\n\t{\n\t\t// home\n\t\tapp.get('/', Controller.index);\n\n\t\t// stuff\n\t\tapp.get('/secure', Controller.secure);\n\t\tapp.get('/ping', Controller.ping);\n\t\tapp.get('/update', Controller.update);\n\t\tapp.get('/version', Controller.version);\n\n\t\tapp.get('/toggle', Controller.toggle);\n\n\t\tapp.get('/secure', Controller.secure);\n\t\tapp.get('/secure1', Controller.secure1);\n\n\t\t// access\n\t\tapp.get('/logout', Controller.logout);\n\t\tapp.get('/login', Controller.login);\n\t\tapp.post('/login', Controller.loginPost);\n\n\t\t// api\n\t\tapp.get('/api', Controller.api);\n\t\tapp.post('/api', Controller.apiPost);\n\n\t\t// test app\n\t\tapp.get('/test', Controller.test);\n\t\tapp.get('/test/id', Controller.testId);\n\t\tapp.get('/test/:id', Controller.testById);\n\t\tapp.get('/test/foo/:id', Controller.testFooById);\n\n\t\t// app.route('/book')\n\t\t// \t.get(function (req, res) {\n\t\t// \t\tres.send('Get a random book');\n\t\t// \t})\n\t\t// \t.post(function (req, res) {\n\t\t// \t\tres.send('Add a book');\n\t\t// \t})\n\t\t// \t.put(function (req, res) {\n\t\t// \t\tres.send('Update the book');\n\t\t// \t});\n\t}\n}","package model.constants;\n\nimport haxe.macro.Context;\n\nclass App {\n\n\tpublic static inline var PROJECT_NAME : String  = \"[Skeletor]\";\n\n\tpublic static inline var URL : String  = \"https://skeletor.herokuapp.com/\";\n\tpublic static inline var PORT : String  = \"5000\";\n\n\tpublic static var BUILD : String = getBuildDate();\n\n\tmacro public static function getBuildDate() {\n\t\tvar date = Date.now().toString();\n\t\treturn Context.makeExpr(date, Context.currentPos());\n\t}\n\n}"],
"names":[],
"mappings":"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"
}